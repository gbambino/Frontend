{"ast":null,"code":"import _regeneratorRuntime from\"/home/kodachi/Desktop/Frontend1/Frontend1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/kodachi/Desktop/Frontend1/Frontend1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/kodachi/Desktop/Frontend1/Frontend1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/kodachi/Desktop/Frontend1/Frontend1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useState,useCallback}from'react';import styled from'styled-components';import{Button,useModal,IconButton,AddIcon,MinusIcon,Skeleton,Text}from'@pancakeswap/uikit';import{useLocation}from'react-router-dom';import{BigNumber}from'bignumber.js';import UnlockButton from'components/UnlockButton';import Balance from'components/Balance';import{useWeb3React}from'@web3-react/core';import{useFarmUser,useLpTokenPrice}from'state/hooks';import{fetchFarmUserDataAsync}from'state/farms';import{useTranslation}from'contexts/Localization';import{useERC20}from'hooks/useContract';import{BASE_ADD_LIQUIDITY_URL}from'config';import{useAppDispatch}from'state';import{getAddress}from'utils/addressHelpers';import getLiquidityUrlPathParts from'utils/getLiquidityUrlPathParts';import{getBalanceAmount,getBalanceNumber,getFullDisplayBalance}from'utils/formatBalance';import useUnstakeFarms from'../../../hooks/useUnstakeFarms';import DepositModal from'../../DepositModal';import WithdrawModal from'../../WithdrawModal';import useStakeFarms from'../../../hooks/useStakeFarms';import useApproveFarm from'../../../hooks/useApproveFarm';import{ActionContainer,ActionTitles,ActionContent,Earned}from'./styles';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var IconButtonWrapper=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  display: flex;\\n\"])));var Staked=function Staked(_ref){var pid=_ref.pid,lpSymbol=_ref.lpSymbol,lpAddresses=_ref.lpAddresses,quoteToken=_ref.quoteToken,token=_ref.token,userDataReady=_ref.userDataReady;var _useTranslation=useTranslation(),t=_useTranslation.t;var _useWeb3React=useWeb3React(),account=_useWeb3React.account;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),requestedApproval=_useState2[0],setRequestedApproval=_useState2[1];var _useFarmUser=useFarmUser(pid),allowance=_useFarmUser.allowance,tokenBalance=_useFarmUser.tokenBalance,stakedBalance=_useFarmUser.stakedBalance;var _useStakeFarms=useStakeFarms(pid),onStake=_useStakeFarms.onStake;var _useUnstakeFarms=useUnstakeFarms(pid),onUnstake=_useUnstakeFarms.onUnstake;var location=useLocation();var lpPrice=useLpTokenPrice(lpSymbol);var isApproved=account&&allowance&&allowance.isGreaterThan(0);var lpAddress=getAddress(lpAddresses);var liquidityUrlPathParts=getLiquidityUrlPathParts({quoteTokenAddress:quoteToken.address,tokenAddress:token.address});var addLiquidityUrl=\"\".concat(BASE_ADD_LIQUIDITY_URL,\"/\").concat(liquidityUrlPathParts);var handleStake=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(amount){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return onStake(amount);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context.stop();}}},_callee);}));return function handleStake(_x){return _ref2.apply(this,arguments);};}();var handleUnstake=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(amount){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return onUnstake(amount);case 2:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function handleUnstake(_x2){return _ref3.apply(this,arguments);};}();var displayBalance=useCallback(function(){var stakedBalanceBigNumber=getBalanceAmount(stakedBalance);if(stakedBalanceBigNumber.gt(0)&&stakedBalanceBigNumber.lt(0.0001)){return getFullDisplayBalance(stakedBalance).toLocaleString();}return stakedBalanceBigNumber.toFixed(3,BigNumber.ROUND_DOWN);},[stakedBalance]);var _useModal=useModal(/*#__PURE__*/_jsx(DepositModal,{max:tokenBalance,onConfirm:handleStake,tokenName:lpSymbol,addLiquidityUrl:addLiquidityUrl})),_useModal2=_slicedToArray(_useModal,1),onPresentDeposit=_useModal2[0];var _useModal3=useModal(/*#__PURE__*/_jsx(WithdrawModal,{max:stakedBalance,onConfirm:handleUnstake,tokenName:lpSymbol})),_useModal4=_slicedToArray(_useModal3,1),onPresentWithdraw=_useModal4[0];var lpContract=useERC20(lpAddress);var dispatch=useAppDispatch();var _useApproveFarm=useApproveFarm(lpContract),onApprove=_useApproveFarm.onApprove;var handleApprove=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setRequestedApproval(true);_context3.next=4;return onApprove();case 4:dispatch(fetchFarmUserDataAsync({account:account,pids:[pid]}));setRequestedApproval(false);_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);})),[onApprove,dispatch,account,pid]);if(!account){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(UnlockButton,{width:\"100%\"})})]});}if(isApproved){if(stakedBalance.gt(0)){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",pr:\"4px\",children:lpSymbol}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Staked')})]}),/*#__PURE__*/_jsxs(ActionContent,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Earned,{children:displayBalance()}),stakedBalance.gt(0)&&lpPrice.gt(0)&&/*#__PURE__*/_jsx(Balance,{fontSize:\"12px\",color:\"textSubtle\",decimals:2,value:getBalanceNumber(lpPrice.times(stakedBalance)),unit:\" USD\",prefix:\"~\"})]}),/*#__PURE__*/_jsxs(IconButtonWrapper,{children:[/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentWithdraw,mr:\"6px\",children:/*#__PURE__*/_jsx(MinusIcon,{color:\"primary\",width:\"14px\"})}),/*#__PURE__*/_jsx(IconButton,{variant:\"secondary\",onClick:onPresentDeposit,disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:/*#__PURE__*/_jsx(AddIcon,{color:\"primary\",width:\"14px\"})})]})]})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsxs(ActionTitles,{children:[/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",pr:\"4px\",children:t('Stake').toUpperCase()}),/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"secondary\",fontSize:\"12px\",children:lpSymbol})]}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",onClick:onPresentDeposit,variant:\"secondary\",disabled:['history','archived'].some(function(item){return location.pathname.includes(item);}),children:t('Stake LP')})})]});}if(!userDataReady){return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Start Farming')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Skeleton,{width:180,marginBottom:28,marginTop:14})})]});}return/*#__PURE__*/_jsxs(ActionContainer,{children:[/*#__PURE__*/_jsx(ActionTitles,{children:/*#__PURE__*/_jsx(Text,{bold:true,textTransform:\"uppercase\",color:\"textSubtle\",fontSize:\"12px\",children:t('Enable Farm')})}),/*#__PURE__*/_jsx(ActionContent,{children:/*#__PURE__*/_jsx(Button,{width:\"100%\",disabled:requestedApproval,onClick:handleApprove,variant:\"secondary\",children:t('Enable')})})]});};export default Staked;","map":{"version":3,"sources":["/home/kodachi/Desktop/Frontend1/Frontend1/src/views/Farms/components/FarmTable/Actions/StakedAction.tsx"],"names":["React","useState","useCallback","styled","Button","useModal","IconButton","AddIcon","MinusIcon","Skeleton","Text","useLocation","BigNumber","UnlockButton","Balance","useWeb3React","useFarmUser","useLpTokenPrice","fetchFarmUserDataAsync","useTranslation","useERC20","BASE_ADD_LIQUIDITY_URL","useAppDispatch","getAddress","getLiquidityUrlPathParts","getBalanceAmount","getBalanceNumber","getFullDisplayBalance","useUnstakeFarms","DepositModal","WithdrawModal","useStakeFarms","useApproveFarm","ActionContainer","ActionTitles","ActionContent","Earned","IconButtonWrapper","div","Staked","pid","lpSymbol","lpAddresses","quoteToken","token","userDataReady","t","account","requestedApproval","setRequestedApproval","allowance","tokenBalance","stakedBalance","onStake","onUnstake","location","lpPrice","isApproved","isGreaterThan","lpAddress","liquidityUrlPathParts","quoteTokenAddress","address","tokenAddress","addLiquidityUrl","handleStake","amount","dispatch","pids","handleUnstake","displayBalance","stakedBalanceBigNumber","gt","lt","toLocaleString","toFixed","ROUND_DOWN","onPresentDeposit","onPresentWithdraw","lpContract","onApprove","handleApprove","console","error","times","some","item","pathname","includes","toUpperCase"],"mappings":"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","sourcesContent":["import React, { useState, useCallback } from 'react'\nimport styled from 'styled-components'\nimport { Button, useModal, IconButton, AddIcon, MinusIcon, Skeleton, Text } from '@pancakeswap/uikit'\nimport { useLocation } from 'react-router-dom'\nimport { BigNumber } from 'bignumber.js'\nimport UnlockButton from 'components/UnlockButton'\nimport Balance from 'components/Balance'\nimport { useWeb3React } from '@web3-react/core'\nimport { useFarmUser, useLpTokenPrice } from 'state/hooks'\nimport { fetchFarmUserDataAsync } from 'state/farms'\nimport { FarmWithStakedValue } from 'views/Farms/components/FarmCard/FarmCard'\nimport { useTranslation } from 'contexts/Localization'\nimport { useERC20 } from 'hooks/useContract'\nimport { BASE_ADD_LIQUIDITY_URL } from 'config'\nimport { useAppDispatch } from 'state'\nimport { getAddress } from 'utils/addressHelpers'\nimport getLiquidityUrlPathParts from 'utils/getLiquidityUrlPathParts'\nimport { getBalanceAmount, getBalanceNumber, getFullDisplayBalance } from 'utils/formatBalance'\nimport useUnstakeFarms from '../../../hooks/useUnstakeFarms'\nimport DepositModal from '../../DepositModal'\nimport WithdrawModal from '../../WithdrawModal'\nimport useStakeFarms from '../../../hooks/useStakeFarms'\nimport useApproveFarm from '../../../hooks/useApproveFarm'\nimport { ActionContainer, ActionTitles, ActionContent, Earned } from './styles'\n\nconst IconButtonWrapper = styled.div`\n  display: flex;\n`\n\ninterface StackedActionProps extends FarmWithStakedValue {\n  userDataReady: boolean\n}\n\nconst Staked: React.FunctionComponent<StackedActionProps> = ({\n  pid,\n  lpSymbol,\n  lpAddresses,\n  quoteToken,\n  token,\n  userDataReady,\n}) => {\n  const { t } = useTranslation()\n  const { account } = useWeb3React()\n  const [requestedApproval, setRequestedApproval] = useState(false)\n  const { allowance, tokenBalance, stakedBalance } = useFarmUser(pid)\n  const { onStake } = useStakeFarms(pid)\n  const { onUnstake } = useUnstakeFarms(pid)\n  const location = useLocation()\n  const lpPrice = useLpTokenPrice(lpSymbol)\n\n  const isApproved = account && allowance && allowance.isGreaterThan(0)\n\n  const lpAddress = getAddress(lpAddresses)\n  const liquidityUrlPathParts = getLiquidityUrlPathParts({\n    quoteTokenAddress: quoteToken.address,\n    tokenAddress: token.address,\n  })\n  const addLiquidityUrl = `${BASE_ADD_LIQUIDITY_URL}/${liquidityUrlPathParts}`\n\n  const handleStake = async (amount: string) => {\n    await onStake(amount)\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n  }\n\n  const handleUnstake = async (amount: string) => {\n    await onUnstake(amount)\n    dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n  }\n\n  const displayBalance = useCallback(() => {\n    const stakedBalanceBigNumber = getBalanceAmount(stakedBalance)\n    if (stakedBalanceBigNumber.gt(0) && stakedBalanceBigNumber.lt(0.0001)) {\n      return getFullDisplayBalance(stakedBalance).toLocaleString()\n    }\n    return stakedBalanceBigNumber.toFixed(3, BigNumber.ROUND_DOWN)\n  }, [stakedBalance])\n\n  const [onPresentDeposit] = useModal(\n    <DepositModal max={tokenBalance} onConfirm={handleStake} tokenName={lpSymbol} addLiquidityUrl={addLiquidityUrl} />,\n  )\n  const [onPresentWithdraw] = useModal(\n    <WithdrawModal max={stakedBalance} onConfirm={handleUnstake} tokenName={lpSymbol} />,\n  )\n  const lpContract = useERC20(lpAddress)\n  const dispatch = useAppDispatch()\n  const { onApprove } = useApproveFarm(lpContract)\n\n  const handleApprove = useCallback(async () => {\n    try {\n      setRequestedApproval(true)\n      await onApprove()\n      dispatch(fetchFarmUserDataAsync({ account, pids: [pid] }))\n\n      setRequestedApproval(false)\n    } catch (e) {\n      console.error(e)\n    }\n  }, [onApprove, dispatch, account, pid])\n\n  if (!account) {\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n            {t('Start Farming')}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <UnlockButton width=\"100%\" />\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  if (isApproved) {\n    if (stakedBalance.gt(0)) {\n      return (\n        <ActionContainer>\n          <ActionTitles>\n            <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\" pr=\"4px\">\n              {lpSymbol}\n            </Text>\n            <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n              {t('Staked')}\n            </Text>\n          </ActionTitles>\n          <ActionContent>\n            <div>\n              <Earned>{displayBalance()}</Earned>\n              {stakedBalance.gt(0) && lpPrice.gt(0) && (\n                <Balance\n                  fontSize=\"12px\"\n                  color=\"textSubtle\"\n                  decimals={2}\n                  value={getBalanceNumber(lpPrice.times(stakedBalance))}\n                  unit=\" USD\"\n                  prefix=\"~\"\n                />\n              )}\n            </div>\n            <IconButtonWrapper>\n              <IconButton variant=\"secondary\" onClick={onPresentWithdraw} mr=\"6px\">\n                <MinusIcon color=\"primary\" width=\"14px\" />\n              </IconButton>\n              <IconButton\n                variant=\"secondary\"\n                onClick={onPresentDeposit}\n                disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\n              >\n                <AddIcon color=\"primary\" width=\"14px\" />\n              </IconButton>\n            </IconButtonWrapper>\n          </ActionContent>\n        </ActionContainer>\n      )\n    }\n\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\" pr=\"4px\">\n            {t('Stake').toUpperCase()}\n          </Text>\n          <Text bold textTransform=\"uppercase\" color=\"secondary\" fontSize=\"12px\">\n            {lpSymbol}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <Button\n            width=\"100%\"\n            onClick={onPresentDeposit}\n            variant=\"secondary\"\n            disabled={['history', 'archived'].some((item) => location.pathname.includes(item))}\n          >\n            {t('Stake LP')}\n          </Button>\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  if (!userDataReady) {\n    return (\n      <ActionContainer>\n        <ActionTitles>\n          <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n            {t('Start Farming')}\n          </Text>\n        </ActionTitles>\n        <ActionContent>\n          <Skeleton width={180} marginBottom={28} marginTop={14} />\n        </ActionContent>\n      </ActionContainer>\n    )\n  }\n\n  return (\n    <ActionContainer>\n      <ActionTitles>\n        <Text bold textTransform=\"uppercase\" color=\"textSubtle\" fontSize=\"12px\">\n          {t('Enable Farm')}\n        </Text>\n      </ActionTitles>\n      <ActionContent>\n        <Button width=\"100%\" disabled={requestedApproval} onClick={handleApprove} variant=\"secondary\">\n          {t('Enable')}\n        </Button>\n      </ActionContent>\n    </ActionContainer>\n  )\n}\n\nexport default Staked\n"]},"metadata":{},"sourceType":"module"}