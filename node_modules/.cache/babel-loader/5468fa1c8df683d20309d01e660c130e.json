{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useWeb3React } from '@web3-react/core';\nimport { LotteryStatus } from 'config/constants/types';\nimport usePreviousValue from 'hooks/usePreviousValue';\nimport { useEffect } from 'react';\nimport { useAppDispatch } from 'state';\nimport { useLottery } from 'state/hooks';\nimport { fetchPastLotteries, fetchCurrentLotteryId, fetchUserLotteries } from 'state/lottery';\n\nconst useStatusTransitions = () => {\n  _s();\n\n  const {\n    currentLotteryId,\n    isTransitioning,\n    currentRound: {\n      status\n    }\n  } = useLottery();\n  const {\n    account\n  } = useWeb3React();\n  const dispatch = useAppDispatch();\n  const previousStatus = usePreviousValue(status);\n  useEffect(() => {\n    // Only run if there is a status state change\n    if (previousStatus !== status) {\n      // Current lottery transitions from CLOSE > CLAIMABLE\n      if (previousStatus === LotteryStatus.CLOSE && status === LotteryStatus.CLAIMABLE) {\n        dispatch(fetchPastLotteries());\n\n        if (account) {\n          dispatch(fetchUserLotteries({\n            account\n          }));\n        }\n      } // Previous lottery to new lottery. From CLAIMABLE (previous round) > OPEN (new round)\n\n\n      if (previousStatus === LotteryStatus.CLAIMABLE && status === LotteryStatus.OPEN) {\n        dispatch(fetchPastLotteries());\n\n        if (account) {\n          dispatch(fetchUserLotteries({\n            account\n          }));\n        }\n      }\n    }\n  }, [currentLotteryId, status, previousStatus, account, dispatch]);\n  useEffect(() => {\n    // Current lottery is CLAIMABLE and the lottery is transitioning to a NEW round - fetch current lottery ID every 10s.\n    // The isTransitioning condition will no longer be true when fetchCurrentLotteryId returns the next lottery ID\n    if (previousStatus === LotteryStatus.CLAIMABLE && status === LotteryStatus.CLAIMABLE && isTransitioning) {\n      dispatch(fetchCurrentLotteryId());\n      dispatch(fetchPastLotteries());\n      const interval = setInterval(async () => {\n        dispatch(fetchCurrentLotteryId());\n        dispatch(fetchPastLotteries());\n      }, 10000);\n      return () => clearInterval(interval);\n    }\n\n    return () => null;\n  }, [status, previousStatus, isTransitioning, dispatch]);\n};\n\n_s(useStatusTransitions, \"UJdh38ZnXget+vjsjQAqypnT41M=\", false, function () {\n  return [useLottery, useWeb3React, useAppDispatch, usePreviousValue];\n});\n\nexport default useStatusTransitions;","map":{"version":3,"sources":["/home/kodachi/Desktop/Frontend1/src/views/Lottery/hooks/useStatusTransitions.tsx"],"names":["useWeb3React","LotteryStatus","usePreviousValue","useEffect","useAppDispatch","useLottery","fetchPastLotteries","fetchCurrentLotteryId","fetchUserLotteries","useStatusTransitions","currentLotteryId","isTransitioning","currentRound","status","account","dispatch","previousStatus","CLOSE","CLAIMABLE","OPEN","interval","setInterval","clearInterval"],"mappings":";;AAAA,SAASA,YAAT,QAA6B,kBAA7B;AACA,SAASC,aAAT,QAA8B,wBAA9B;AACA,OAAOC,gBAAP,MAA6B,wBAA7B;AACA,SAASC,SAAT,QAA0B,OAA1B;AACA,SAASC,cAAT,QAA+B,OAA/B;AACA,SAASC,UAAT,QAA2B,aAA3B;AACA,SAASC,kBAAT,EAA6BC,qBAA7B,EAAoDC,kBAApD,QAA8E,eAA9E;;AAEA,MAAMC,oBAAoB,GAAG,MAAM;AAAA;;AACjC,QAAM;AACJC,IAAAA,gBADI;AAEJC,IAAAA,eAFI;AAGJC,IAAAA,YAAY,EAAE;AAAEC,MAAAA;AAAF;AAHV,MAIFR,UAAU,EAJd;AAMA,QAAM;AAAES,IAAAA;AAAF,MAAcd,YAAY,EAAhC;AACA,QAAMe,QAAQ,GAAGX,cAAc,EAA/B;AACA,QAAMY,cAAc,GAAGd,gBAAgB,CAACW,MAAD,CAAvC;AAEAV,EAAAA,SAAS,CAAC,MAAM;AACd;AACA,QAAIa,cAAc,KAAKH,MAAvB,EAA+B;AAC7B;AACA,UAAIG,cAAc,KAAKf,aAAa,CAACgB,KAAjC,IAA0CJ,MAAM,KAAKZ,aAAa,CAACiB,SAAvE,EAAkF;AAChFH,QAAAA,QAAQ,CAACT,kBAAkB,EAAnB,CAAR;;AACA,YAAIQ,OAAJ,EAAa;AACXC,UAAAA,QAAQ,CAACP,kBAAkB,CAAC;AAAEM,YAAAA;AAAF,WAAD,CAAnB,CAAR;AACD;AACF,OAP4B,CAQ7B;;;AACA,UAAIE,cAAc,KAAKf,aAAa,CAACiB,SAAjC,IAA8CL,MAAM,KAAKZ,aAAa,CAACkB,IAA3E,EAAiF;AAC/EJ,QAAAA,QAAQ,CAACT,kBAAkB,EAAnB,CAAR;;AACA,YAAIQ,OAAJ,EAAa;AACXC,UAAAA,QAAQ,CAACP,kBAAkB,CAAC;AAAEM,YAAAA;AAAF,WAAD,CAAnB,CAAR;AACD;AACF;AACF;AACF,GAlBQ,EAkBN,CAACJ,gBAAD,EAAmBG,MAAnB,EAA2BG,cAA3B,EAA2CF,OAA3C,EAAoDC,QAApD,CAlBM,CAAT;AAoBAZ,EAAAA,SAAS,CAAC,MAAM;AACd;AACA;AACA,QAAIa,cAAc,KAAKf,aAAa,CAACiB,SAAjC,IAA8CL,MAAM,KAAKZ,aAAa,CAACiB,SAAvE,IAAoFP,eAAxF,EAAyG;AACvGI,MAAAA,QAAQ,CAACR,qBAAqB,EAAtB,CAAR;AACAQ,MAAAA,QAAQ,CAACT,kBAAkB,EAAnB,CAAR;AACA,YAAMc,QAAQ,GAAGC,WAAW,CAAC,YAAY;AACvCN,QAAAA,QAAQ,CAACR,qBAAqB,EAAtB,CAAR;AACAQ,QAAAA,QAAQ,CAACT,kBAAkB,EAAnB,CAAR;AACD,OAH2B,EAGzB,KAHyB,CAA5B;AAIA,aAAO,MAAMgB,aAAa,CAACF,QAAD,CAA1B;AACD;;AACD,WAAO,MAAM,IAAb;AACD,GAbQ,EAaN,CAACP,MAAD,EAASG,cAAT,EAAyBL,eAAzB,EAA0CI,QAA1C,CAbM,CAAT;AAcD,CA7CD;;GAAMN,oB;UAKAJ,U,EAEgBL,Y,EACHI,c,EACMF,gB;;;AAsCzB,eAAeO,oBAAf","sourcesContent":["import { useWeb3React } from '@web3-react/core'\nimport { LotteryStatus } from 'config/constants/types'\nimport usePreviousValue from 'hooks/usePreviousValue'\nimport { useEffect } from 'react'\nimport { useAppDispatch } from 'state'\nimport { useLottery } from 'state/hooks'\nimport { fetchPastLotteries, fetchCurrentLotteryId, fetchUserLotteries } from 'state/lottery'\n\nconst useStatusTransitions = () => {\n  const {\n    currentLotteryId,\n    isTransitioning,\n    currentRound: { status },\n  } = useLottery()\n\n  const { account } = useWeb3React()\n  const dispatch = useAppDispatch()\n  const previousStatus = usePreviousValue(status)\n\n  useEffect(() => {\n    // Only run if there is a status state change\n    if (previousStatus !== status) {\n      // Current lottery transitions from CLOSE > CLAIMABLE\n      if (previousStatus === LotteryStatus.CLOSE && status === LotteryStatus.CLAIMABLE) {\n        dispatch(fetchPastLotteries())\n        if (account) {\n          dispatch(fetchUserLotteries({ account }))\n        }\n      }\n      // Previous lottery to new lottery. From CLAIMABLE (previous round) > OPEN (new round)\n      if (previousStatus === LotteryStatus.CLAIMABLE && status === LotteryStatus.OPEN) {\n        dispatch(fetchPastLotteries())\n        if (account) {\n          dispatch(fetchUserLotteries({ account }))\n        }\n      }\n    }\n  }, [currentLotteryId, status, previousStatus, account, dispatch])\n\n  useEffect(() => {\n    // Current lottery is CLAIMABLE and the lottery is transitioning to a NEW round - fetch current lottery ID every 10s.\n    // The isTransitioning condition will no longer be true when fetchCurrentLotteryId returns the next lottery ID\n    if (previousStatus === LotteryStatus.CLAIMABLE && status === LotteryStatus.CLAIMABLE && isTransitioning) {\n      dispatch(fetchCurrentLotteryId())\n      dispatch(fetchPastLotteries())\n      const interval = setInterval(async () => {\n        dispatch(fetchCurrentLotteryId())\n        dispatch(fetchPastLotteries())\n      }, 10000)\n      return () => clearInterval(interval)\n    }\n    return () => null\n  }, [status, previousStatus, isTransitioning, dispatch])\n}\n\nexport default useStatusTransitions\n"]},"metadata":{},"sourceType":"module"}